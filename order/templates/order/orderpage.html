{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}Order Page{% endblock %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<!-- <link rel="stylesheet" type="text/css" href="{% static 'base.css' %}" /> -->
<link rel="stylesheet" type="text/css" href="{% static 'order/orderpage.css' %}" />
{% endblock %}

{% block body %}
<script>
  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>
<br>
<button type="button" class="collapsible text-center btn btn-primary btn-lg btn-block">Current Shares Info</button>
<div class="content">

  <div class="form-group row">
    <label for="cash" class="col-4 col-form-label">Cash</label>
    <div class="col-8 mt-2">
      <p class="collapse_text">${{current_agent.Cash}}</p>
    </div>
  </div>
  <div class="form-group row">
    <label for="shares" class="col-4 col-form-label">Shares</label>
    <div class="col-8">
      <div id="SharesDiv">
        <div class="row font-weight-bold">
          <div class="col">Company</div>
          <div class="col">Shares</div>
          <div class="col">Borrowed</div>
          <div class="col">Collateral</div>
        </div>
        {% for share in current_agent_shares %}
        <div class="row collapse_text">
          <div class="col">{{ share.Company }}</div>
          <div class="col">{{ share.Shares }}</div>
          <div class="col">{{ share.Borrowed }}</div>
          <div class="col">${{ share.Collateral }}</div>
        </div>
        {% endfor %}
      </div>

    </div>
  </div></div>

<header class="container-fluid text-center">
  <p class="heading">Place Order</p>
  <!-- <script>
    function deleteOrder() {
      $(document).on('click', ':button', function () {
        $(this).parent().remove();
      });
    }
  </script> -->
</header>

<form method="POST" id="order_form"> {% csrf_token %}
  <!-- Inner Divs -->
  <div class="container text-center">
    <!--<div class="row content">-->
    <div class="d-flex flex-row" id="InterDiv">
      <!-- Dropdown Div -->
      <div class="d-flex flex-column" id="InterLeft">
        <div class="p-2">
          <div class="dropdown">
            {{ form.Direction|as_crispy_field }}
          </div>
        </div>

        <div class="p-2">
          <div class="dropdown">
            {{ form.OrderBookName|as_crispy_field }}
          </div>
        </div>

        <div class="p-2" data-toggle="tooltip" title="Note: choosing limit means you set your maximum buy price or
        minimum sell price (recommended). Choosing market means you want to buy from the current
            lowest seller or want to sell to the current highest buyer.">
          <div class="dropdown">
            {{ form.Type|as_crispy_field }}
          </div>
        </div>
      </div>

      <!-- Textbox Div -->
      <div class="d-flex flex-column" id="InterRight">
        <div class="p-2" id="PriceTextBox">
          <div class="form-group">
            {{ form.Price|as_crispy_field }}
          </div>
        </div>
        <div class="p-2">
          <div class="form-group">
            {{ form.Quantity|as_crispy_field }}
          </div>
        </div>
      </div>
    </div>

  </div>

  <br>
  <!-- Place Order Button -->
  <button type="submit" class="btn btn-primary btn-lg btn-block" id="PlaceOrderButton">Place Order</button>

</form>

<br><br><br>

<!-- Active Order header -->
<header class="container-fluid text-center">
  <p>Your Active Orders</p>
</header>

<div id="ActiveOrders" class="container-fluid text-center">
 <div class="p-2">
    <form id="aselect_dropdown" action="" method="GET">
      <label for="aselectcompany">
        <p id="aSelectCompanyLabel">Select Company:  </p>
      </label>
      <select id="acompany_dropdown" name="acompany_form">
        <option value="">show all</option>
        {% for company in all_companies %}
        <option value="{{ company.Ticker }}">{{ company.Ticker }}</option>
        {% endfor %}
      </select>
    </form>
  </div>
</div>

<!-- when reading from database, you can probably go through a for loop and add multiple rows depending on the info -->
<div class="container-fluid ActiveOrderInfoDiv" id="YourOrdersDiv">
  {% include 'order/yourorders.html' %}
</div>

<br><br><br>

<header class="container-fluid text-center">
  <p>All Active Orders</p>
</header>

<!-- Dropdown Menu -->
<div id="CurrentOrders" class="container-fluid text-center">
 <div class="p-2">
   <div class="all_forms">
    <form id="select_dropdown" action="" method="GET">
      <label for="selectcompany">
        <p id="SelectCompanyLabel">Select Company:  </p>
      </label>
      <select id="company_dropdown" name="company_form">
        <option value="">show all</option>
        {% for company in all_companies %}
        <option value="{{ company.Ticker }}">{{ company.Ticker }}</option>
        {% endfor %}
      </select>
    </form>
    <button id="RefreshOrderButton" class="btn btn-primary">Refresh</button>
    </div>
  </div>
</div>

<br>

<!-- Asks/Bids Div -->
<div class="container-fluid text-center ActiveOrderInfoDiv" id="AllOrdersDiv">
  {% include 'order/allorders.html' %}
</div>
<br>
<br>

<script src="{% static 'order/ajaxscript.js' %}"></script>
<script>
  $(document).on("click", "#RefreshOrderButton", function (e) {
    e.preventDefault();
    console.log("hi")
    $.ajax({
      type: 'GET',
      url: "/order/orderfilter/",
      data: {"company": $("#company_dropdown").val()},
      success: function (data) {
        $('#AllOrdersDiv').html(data)
      },
      error: function (data) {
      }
    });
  });
</script>

<script>
  var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
</script>

{% endblock body %}
